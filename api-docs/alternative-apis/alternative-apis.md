# Virtualstock API - Alternative Integration Methods

## Flat File API (CSV via SFTP) for Suppliers

If you are unable to integrate your applications with our REST API or have a previous integration to Virtualstock with our Flat file SFTP API that you would like to replicate for your integration, then please download our Flat file CSV over SFTP API documentation.

**VIEW FLAT FILE SFTP API DOCUMENTATION**

## Invoice as JSON Files via SFTP for Retailers

This interface is for retailers to receive invoices created by suppliers as single JSON files over SFTP for each invoice.

**DOWNLOAD JSON FILE SFTP INVOICES API DOCUMENTATION**

## Order Events Report CSV via SFTP for Retailers

This interface is for retailers to receive CSV files over SFTP all events made by suppliers or carriers to orders. "Events" are order line status changes, order comments and tracking.

**DOWNLOAD EVENT REPORT DOCUMENTATION**

## Order Tracking Status Updates via Webhook

### Introduction

The purpose of this Webhook API is for a retailer to receive all the orders tracking status updates that are made by suppliers or their carriers. The retailer will need to build a REST API to the specifications detailed below, and Virtualstock will require the URL and credentials to start receiving these updates.

### Authentication

The Webhook APIs use Basic Authentication. Usernames and passwords for the environment that Virtualstock needs to interact with need to be provided to Virtualstock when the API is ready for testing.

### Content Types

This service sends JSON content with a Content-Type header set to `application/json`.

### Payload, Method and Endpoint

**POST** the following payload to a URL of your choosing.

#### Webhook Payload Structure

```json
{
    "channel": "CHANNEL1",  // (optional)
    "carrier": "DPD",
    "dispatched_date": "2019-05-23T00:00:00+0000",
    "estimated_delivery_date": "2019-05-23T00:00:00+0000",
    "order_number": "ORDER121821",
    "tracking_number": "TXD98798798798",
    "tracking_url": "https://www.some.site.com/tracking",
    "status": "DELIVERED",
    "checkpoint_time": "2019-05-23T13:09:51+0000",
    "tracking_message": "Manchester HUB",
    "items": [
        {
            "line_ref": "001",
            "part_number": "sku-002014",
            "quantity": 10
        }
    ],
    "ts": 15484698531106  // (unique timestamp)
}
```

#### Webhook Field Definitions

| Field name | DataType | Description |
|------------|----------|-------------|
| part_number | Text255 | The unique identifier for the product |
| line_ref | Text100 | The line reference is unique to each line on the order |
| quantity | Positive Integer | The number of items from the original order that are Dispatched with this shipment |
| order_number | Text100 | Unique order reference |
| channel | Text100 | (optional) An "Order Channel" that you have configured for your instance of Virtualstock. Channels are used to separate orders by Region, or Buying groups within one organisation. Use "" if you do not use Channels. |
| tracking_number | Text100 | The consignment or tracking number provided to Virtualstock by the supplier when they Dispatch the order |
| status | Text50 | The current tracking status of the order item, e.g PENDING, DELIVERED. See all the statuses that could be provided here in the Order status section > "Tracking status" table |
| tracking_message | Text255 | Comment related to the status change. e.g. "Arrived at Hub" |
| carrier | Text100 | Carrier name e.g. "Green van". This will have been set on Dispatch of the order, but if provided this will replace the value defined on dispatch |
| tracking_url | Text255 | Some suppliers will provide the Carrier's website tracking URL. This is very often not populated, but Virtualstock will pass it on if we receive it from suppliers |
| dispatch_date | DateTime | The Date that the supplier provided to Virtualstock to indicate when the order was Dispatched from their warehouse. e.g. 2019-05-23T00:00:00+0000 (UTC) |
| estimated_delivery_date | DateTime | The Date that the supplier provided to Virtualstock to indicate when the order is expected to arrive. e.g. 2019-05-23T00:00:00+0000 (UTC) |
| checkpoint_time | DateTime | A number generated by Virtualstock, unique to each tracking message |

### Exception & Error Handling

The expectation is that the Retailer building this Webhook API will respond with the following response codes when Virtualstock calls their API. For any of these errors, if Virtualstock fails to deliver the update, it will attempt to replay failed messages several times over the course of 24 hours. Virtualstock will log the failure and an alert will be monitored by our Service Desk team, who will be in touch to help resolve connectivity.

See [Error Codes and Throttling](../error-codes-and-throttling/error-codes-and-throttling.md) for detailed error code information.
